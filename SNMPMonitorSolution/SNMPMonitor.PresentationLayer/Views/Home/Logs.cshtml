<script type="text/javascript">
    var connection = $.hubConnection();
    connection.logging = true;
    var notifications = connection.createHubProxy("snmpDataHub");
    notifications.on("receiveNewEvent", function (dataValue) {
        $("#logTable").prepend(createLineForTableFromSignalR(dataValue));
    });

    $(document).ready(function () {
        $.ajax({
            url: "@Url.Action("GetAllEvents", "Data")",
            type: "GET",
            success: function (data) {
                $.each(data, function (index, value) {
                    $("#logTable").append(createLineForTable(value));
                });
            },
            error: function () {

            }
        });
    });

    connection.start().done(function () {
        notifications.invoke("joinDataGroup", "Events");
    }).fail(function (e) {
        alert("SignalRError for AgentNr:{{=it.AgentNr}} " +e);
    });

    function createLineForTable(value) {
        return "<tr><td>" + value.EventNr + "</td><td>" + value.ExceptionType + "</td><td>" + value.Category + "</td><td>" + new Date(parseInt(value.EventTimestamp.replace("/Date(", "").replace(")/", ""))) + "</td><td>" + value.HResult + "</td><td>" + value.Message + "</td><td>" + value.Stacktrace + "</td></tr>";
    }

    function createLineForTableFromSignalR(value) {
        return "<tr><td>" + value.EventNr + "</td><td>" + value.ExceptionType + "</td><td>" + value.Category + "</td><td>" + Date.parse(value.EventTimestamp + "+02:00") + "</td><td>" + value.HResult + "</td><td>" + value.Message + "</td><td>" + value.Stacktrace + "</td></tr>";
    }
</script>

<h2>Logs</h2>

<div id="dataContainer" class="table-responsive col-xs-12">
    <table class="table">
        <thead>
            <tr>
                <th>EventNr</th>
                <th>ExceptionType</th>
                <th>Category</th>
                <th>EventTimestamp</th>
                <th>HResult</th>
                <th>Message</th>
                <th>Stacktrace</th>
            </tr>
        </thead>
        <tbody id="logTable"></tbody>
    </table>
</div>

